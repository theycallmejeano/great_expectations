parameters:
  vmImage: '' # Must be specified in primary YAML
  pythonVersion: ["3.7", "3.8", "3.9", "3.10"]

jobs:
  - ${{ each pythonVersion in parameters.pythonVersion }}:
    - job:
      displayName: pip${{ pythonVersion }}
      steps:
        - task: UsePythonVersion@0
          inputs:
            versionSpec: ${{ pythonVersion }}
          displayName: Use Python ${{ pythonVersion }}

        - script: |
            python -m pip install --upgrade pip==21.3.1
            pip install great_expectations
          displayName: 'Install Great Expectations'

        - script: |
            great_expectations --version
            great_expectations -y init --no-usage-stats
            python -c "import great_expectations as ge; print('Successfully imported GE Version:', ge.__version__)"
          displayName: 'Confirm installation'

    - job:
      displayName: conda${{ pythonVersion }}
      steps:
        - task: UsePythonVersion@0
          inputs:
            versionSpec: ${{ pythonVersion }}
          displayName: Use Python ${{ pythonVersion }}

        - bash: echo "##vso[task.prependpath]$CONDA/bin"
          displayName: Add conda to PATH

        - script: |
            conda create --yes --name ge_dev
          displayName: Create Anaconda environment

        - script: |
            source activate ge_dev
            conda install --yes --name ge_dev -c conda-forge great-expectations
          displayName: 'Install Great Expectations'

        - script: |
            source activate ge_dev
            great_expectations --version
            great_expectations -y init --no-usage-stats
            python -c "import great_expectations as ge; print('Successfully imported GE Version:', ge.__version__)"
          displayName: 'Confirm installation'
